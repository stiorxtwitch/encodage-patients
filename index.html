<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Encodage patients ‚Äî Google Sheet</title>
  <style>
    body { font-family: Inter, sans-serif; margin: 0; background: #f7f9fc; color: #111; }
    header { background: #0b76ef; color: #fff; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
    .container { max-width: 1000px; margin: 20px auto; padding: 16px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.1); }
    label { font-weight: 600; display: block; margin-top: 12px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; }
    textarea { min-height: 80px; }
    button { background: #0b76ef; color: white; border: none; padding: 10px 14px; border-radius: 8px; margin-top: 12px; cursor: pointer; }
    button.secondary { background: #eee; color: #333; }
    .report { background: #f8fbff; border: 1px dashed #cde2ff; padding: 12px; border-radius: 8px; white-space: pre-wrap; margin-top: 14px; }
  </style>
</head>
<body>
  <header>
    <h1>Encodage des patients (Google Sheet)</h1>
    <button id="refresh">üîÑ Actualiser</button>
  </header>

  <div class="container">
    <h2>Cr√©er / Modifier un patient</h2>
    <form id="patientForm">
      <label>Pr√©nom Nom du SAMS</label>
      <input type="text" id="samsName" required>
      <label>Pr√©nom Nom ID du patient</label>
      <input type="text" id="patientName" required>
      <label>Date de naissance</label>
      <input type="date" id="dob">
      <label>Profession</label>
      <input type="text" id="profession">
      <label>Ant√©c√©dents (1)</label>
      <input type="text" id="ante1">
      <label>Ant√©c√©dents (2)</label>
      <input type="text" id="ante2">
      <label>Blessures</label>
      <textarea id="blessures"></textarea>
      <label>Raison hospitalisation</label>
      <textarea id="raison"></textarea>
      <label>Examens</label>
      <textarea id="examens"></textarea>
      <label>Co√ªt total ($)</label>
      <input type="number" id="totalCost" value="0">
      <button type="submit">Enregistrer dans le Google Sheet</button>
    </form>

    <h2>Patients enregistr√©s</h2>
    <div id="patientsList">Chargement...</div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycby6-dpZaaQpXlx5TYd9Kjvt8Al09AbURGl6m0fsDl81/dev"; // ‚Üê remplace ceci par ton URL Apps Script

    async function fetchPatients() {
      document.getElementById("patientsList").innerText = "Chargement...";
      const res = await fetch(scriptURL);
      const data = await res.json();
      const html = data.map(p => 
        `<div class="report"><strong>${p.patientName}</strong> ‚Äî ${p.profession||""}
        <br><small>${p.dob||""}</small>
        <br><em>${p.raison||""}</em>
        <br>Co√ªt : ${p.totalCost||0} $</div>`).join("");
      document.getElementById("patientsList").innerHTML = html || "<i>Aucun patient.</i>";
    }

    document.getElementById("patientForm").addEventListener("submit", async e => {
      e.preventDefault();
      const body = {};
      ["samsName","patientName","dob","profession","ante1","ante2","blessures","raison","examens","totalCost"]
        .forEach(id => body[id] = document.getElementById(id).value);
      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(body),
        headers: { "Content-Type": "application/json" }
      });
      alert("Patient enregistr√© !");
      e.target.reset();
      fetchPatients();
    });

    document.getElementById("refresh").addEventListener("click", fetchPatients);
    fetchPatients();
  </script>
</body>
</html>
